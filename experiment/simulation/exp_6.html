<!DOCTYPE html>
<html>
<style>
input[type=text], select {
  width: 100%;
  padding: 12px 20px;
  margin: 8px 0;
  display: inline-block;
  border: 1px solid #ccc;
  border-radius: 4px;
  box-sizing: border-box;
}

input[type=button]{
  width: 100%;
  background-color: #671834;
  color: white;
  padding: 14px 20px;
  margin: 8px 0;
  border: none;
  border-radius: 4px;
  cursor: pointer;
}

input[type=button]:hover {
  background-color: #3E0719;
}
hr 
{
        position: relative;
        top: 20px;
        border: none;
        height: 2px;
        background: #d737a5;
        margin-bottom: 50px;
}

table, th, td {
  border:0px ;
}

</style>

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title><b>FILE FORMAT CONVERSTION</b></title>
	

</head>

<body>
	<p id="demo"></p>

	<form id="myform"   >

		<table align="center">
			<tr>
				<td>
					<label for="myfile">Upload the file:</label>
					<br><br>
					<input type="file" id="file", accept=".txt" required  multiple onchange="obtainfiletype()"/>
				</td>
				<td>			
					<textarea cols="100" rows="10" placeholder="text will appear here">
					</textarea>
				</td>
			</tr>
			<tr>
				<td>
					<p>Sample files :</p>
				</td>
				<td>
					<br>
					<br>
					<a href="Proto-oncogene vav_genebank.txt" download="sample_genbank.txt">Sample_Genbank</a>
					<a href="Proto-oncogene vav_embl.txt" download="sample_embl.txt">Sample_EMBL</a>
					<a href="Proto-oncogene vav_fasta.txt" download="sample_fasta.txt">Sample_FASTA</a>
					<p>Click on the sample file, when opened copy the entire content into a notepad and save as sample.txt. Refresh and load the file</p>
				</td>
			</tr>
			<tr>
				<td>
					<label for="File from">Convert file from:</label>
				</td>
				<td>
					<select name="Filefrom-name" id="Filefrom-name">
						<option value="EMBL">EMBL</option>
				   		<option value="GENBANK">GENBANK</option> 
			 		</select>
				</td>	
			</tr>
			<tr>
				<td>
					<label for="File to">Required file format:</label>
				</td>
				<td>
					<select name="Fileto-name" id="Fileto-name">
						<option value="embl">EMBL</option>
						<option value="genbank">GENBANK</option> 
						<option value="fasta">FASTA</option> 
					</select>
				</td>	
			</tr>

		</table>
		<br>
		<table style="width:30%" align="center">
			<tr>
				<td>
					<input type="button" onclick="output(myform.file)" value="Submit" >
				</td>
			</tr>
		</table>

	
	</form><br><br>
	<hr />
	<pre id="result" align="center"></pre>

<script>
	
	//let input = document.querySelector('a')
	let input = document.querySelector('input');
 	let textarea = document.querySelector('textarea')
 	input.addEventListener('change', () => {
    	let files = input.files;
    	if (files.length == 0) return;
		const file = files[0];
 
    	let reader2 = new FileReader();
		reader2.onload = (e) => {
        const file = e.target.result;
 
        // This is a regular expression to identify carriage
        // Returns and line breaks
        const lines = file.split(/\r\n|\n/);
        textarea.value = lines.join('\n');
 
    };
    reader2.onerror = (e) => alert(e.target.error.name);
    reader2.readAsText(file);
	});


	function obtainfiletype(){
	
		let inpfil = file.files[0];
  		let reader1 = new FileReader();
		//document.getElementById("demo").innerHTML = inpfil;
  		reader1.readAsText(inpfil);
		reader1.onload = function() {
    		//document.getElementById("demo").innerHTML = reader.result;
    		let seq = reader1.result
    		//document.getElementById("demo").innerHTML = seq;
    		const array= seq.split("\n");
			if (array[0].includes('LOCUS')){
				document.getElementById("Filefrom-name").value= "GENBANK";
			}
			else if (array[0].includes('ID')){
				document.getElementById("Filefrom-name").value= "EMBL";
			}
			else {
				alert("Please input a GenBank or EMBL format");
			}
		}
    
	}
	function output(input){
		let file = input.files[0];
  		let reader = new FileReader();

  		reader.readAsText(file);
		reader.onload = function() {
    		//document.getElementById("demo").innerHTML = reader.result;
    		let seq = reader.result
    		//document.getElementById("demo").innerHTML = seq;
    		const array= seq.split("\n");
			if (array[0].includes('LOCUS')){
				//document.getElementById("Filefrom-name").value= "GENBANK";
				if(document.getElementById("Fileto-name"). value== "fasta"){
					let definition= array[1];
    				let newDefinition = definition.replace("DEFINITION", "");
					newDefinition = newDefinition.replace(/(\r\n|\n|\r)/gm, "");
					newDefinition = newDefinition.replace(/\s/, "");
    				//document.getElementById("demo").innerHTML = newDefinition;

    				let version= array[3];
    				let newVersion = version.replace("VERSION", "");
					newVersion = newVersion.replace(/(\r\n|\n|\r)/gm, "");
					newVersion = newVersion.replace(/\s/g, "");
  					//document.getElementById("demo").innerHTML = newVersion;

  					const sequence=[];
  					var len= array.length;
  					//document.getElementById("demo").innerHTML = len;
  					for (let i=0; i<=len; i++){
  						if (array[i].includes('ORIGIN')){
  							var k=0;
  							//document.getElementById("demo").innerHTML = i;
  							for (let j=i+1; j<len-1; j++){
  								//document.getElementById("demo").innerHTML = j;
  								sequence[k]= array[j];
  								k=k+1;
  								//document.getElementById("demo").innerHTML =sequence;		
  								//document.getElementById("demo").innerHTML =sequence.length;		
							}
							break;
  						} 	
									
  					}
  					var seqLen=sequence.length;
  					var newSeq= [];
  			 		//document.getElementById("demo").innerHTML =newSeq;
  					for (let n=0; n<seqLen; n++){
  						newSeq[n]= sequence[n].replace(/\s/g, "");
  						///	document.getElementById("demo").innerHTML =newSeq;
					}
					var newOrigin= newSeq.join('\n');
  					var newstr= newOrigin.replace(/\d/g, '');
					newstr=newstr.toUpperCase();
					const gen_fasta='>|'+newVersion+'|'+ newDefinition+'\n'+newstr;
					document.getElementById("result").innerHTML =("<h1> Results</h1>"+"\n"+"<textarea cols=\"63\" rows=\"25\">"+ gen_fasta +"	</textarea>");
					//document.getElementById("result").innerHTML =gen_fasta;
				
				}
				else if(document.getElementById("Fileto-name"). value== "embl"||"genbank"){
					alert("Required file format can be only fasta format");	
				}
				
			}
			else if(array[0].includes('ID')){
				document.getElementById("Filefrom-name").value= "EMBL";
				if(document.getElementById("Fileto-name"). value== "fasta"){
    				const seq1=[];
    				var len1= array.length;
  					//document.getElementById("demo").innerHTML = array[2];
  					for (let i=0; i<=len1; i++){
						let temp=array[i].split(" ");
						//document.getElementById("demo").innerHTML =temp;
						if (temp.includes('AC')){
							//document.getElementById("demo").innerHTML =temp;
							var newOrgmid = array[i].replace("AC ","");
    						//document.getElementById("demo").innerHTML =newOrgmid;
							newOrgmid = newOrgmid .replace(/\s/g, "");
							
							
    						var acid = newOrgmid.substring(0,(newOrgmid.search(/;/)));
							//document.getElementById("demo").innerHTML =acid;
    						var count = (newOrgmid.match(/;/g) || []).length;
						}
						else if(temp.includes('DE')){
							var newDE = array[i].replace("DE","");
    						newDE = newDE.replace(/(\r\n|\n|\r)/gm, "");
							newDE = newDE.replace(/\s/, "");
    						//document.getElementById("demo").innerHTML =newDE;
						}
  						else if (temp.includes('SQ')){
  							var k=0;
  							//document.getElementById("demo").innerHTML = i;

  							for (let j=i+1; j<len1-1; j++){
  								//document.getElementById("demo").innerHTML = j;
  								seq1[k]= array[j];
  								k=k+1;
  								//document.getElementById("demo").innerHTML =seq1;		
  								//document.getElementById("demo").innerHTML =sequence.length;		
							}
							break;
  						}

  					}
  					var seqLen1=seq1.length;
  					var newSeq1= [];
  			 		//document.getElementById("demo").innerHTML =newSeq1;
  			 		for (let n=0; n<seqLen1; n++){
  						newSeq1[n]= seq1[n].replace(/\s/g, "");
  						//document.getElementById("demo").innerHTML =newSeq1;
					}
					var newEmbl= newSeq1.join('\n');
					newEmbl= newEmbl.replace(/\d/g, '');
					newEmbl=newEmbl.toUpperCase();
					//document.getElementById("demo").innerHTML =newDE;
					const embl_fasta='>|'+ acid+'.'+ count+'|'+ newDE +'\n'+newEmbl;
					document.getElementById("result").innerHTML =("<h1> Results</h1>"+"\n"+"<textarea id=\"res\" cols=\"63\" rows=\"25\">"+ embl_fasta+"</textarea><a href=\"\" download=\"result.txt\"><br><br>Download Result</a>");
					var textcontent = document.getElementById("res").value;
					var downloadableLink = document.createElement('a');
					var textFileAsBlob = new Blob(textcontent, {type:'text/plain'}); 
					downloadLink.href = window.URL.createObjectURL(textFileAsBlob);
    					document.body.appendChild(downloadableLink);
					downloadableLink.click();
					
				}
				else if(document.getElementById("Fileto-name"). value== "embl"||"genbank"){
					alert("Required file format can be only fasta format");	
				}

			}
		}
	}

</script>

</body>

</html>
